---
title: 数据库设计
date: 2024-05-10 09:36:58
categories: 理论知识
---
# 现实世界->ER图
## 基础知识
- E-R图基本元素
实体		用方框表示			[e.g.] 学生，课程，任务
关系		用菱形框表示		
属性		用椭圆框表示		实体和关系都可以有属性
连线		实体-属性, 实体-关系, 关系-属性		1:1, 1:n, m:n
<!-- more -->

- 实体和属性的区分
    - 实体与属性是相对而言的; 同一事物在一种环境中是属性，在另一环境中就必须是实体
    
  <img src="/img/design/pic1.png">
  
- 消除冗余[e.g.]
    - 职工工资单中包括基本工资、补贴、应扣除水电费及实发工资
    - 而实发工资可由前面各项推算，因此可以去掉
    - 在需要查询实发工资时，根据基本工资、补贴、应扣除水电费数据临时生成

- 设计顺序
  
    - 确认系统中的实体 -> 确认各个实体的属性 -> 确认实体间的联系，以及联系的属性

## 例题

- [e.g.] 

  > 司机和汽车
  > 司机：驾驶证编号，名字，地址
  > 汽车：车牌号，型号，出产日期
  > 交通事故：事故编号，地点，日期
  > 拥有：司机可以拥有汽车多对多关系
  > 参与：一个交通事故中可有多个司机和汽车，另外每个司机都可能承担一些赔偿金额

  <img src="/img/design/pic2.png">

- [e.g.]

  > 部门有部门职能的描述属性
  > 项目有项目的描述属性
  > 职员有年龄、性别
  > 职员只能从属于一个部门
  > 职员可以参加项目
  > 某些职员可以主管项目，一个项目只能由1个员工主管，但1个员工可以主管多个项目

  <img src="/img/design/pic3.png">



# ER图->关系模型

## 1:1 关系			

- 可以有2种选择:

  - 将关系单独提炼出一个模型，任意取1个元素为主键

  - 将其中一个实体合并为另一个实体模型的属性
    - 选择要和哪一个关系合并，是由使用场景决定的
    - [e.g.] 如果经常要查询负责某个产品的职工工号，则将职工的工号作为产品模型的一个属性；如果将产品号作为职工模型的一个属性，则还需要进行表连接查询

- [e.g.] (职工与产品间)的**负责**关系为1:1联系

  - 转化为独立的关系模式
    - 负责(<u>职工号</u>,产品号)  / 负责(职工号,<u>产品号</u>)

  - 与职工关系模式合并-在职工关系中加入产品关系的码”产品号”
    - 职工(<u>职工号</u>,姓名,年龄,职称,**产品号**)

  - 与产品关系模式合并-在产品关系中加入职工关系的码”职工号”
    - 产品(<u>产品号</u>,产品名,**职工号**)

## 1:n 关系

- 将**1**端的实体的**主键**，变为**n**端实体的一个**属性**

- [e.g.] (部门与职工间的)属于联系为1:n联系
  - 职工(<u>职工号</u>,姓名,年龄,职称,**部门号**) 

## n:m 关系

- 新建一个关系模型
- [该关系的原主键（若有）, n端实体的主键，m端实体的主键] 3者**共同组成**该新建关系模型的主键

- [e.g.] (仓库与零件间的)库存联系是一个m:n联系
  - 库存(<u>仓库号,零件号</u>,库存量)

## 例题

- [e.g.] 

  <img src="/img/design/pic4.png">

  > 学生（学号，姓名，年龄，性别，籍贯）
  > 教师（教师号，姓名，职称，年龄）
  > 课程（课程号，教师号，课程名，学分）
  > 选课（学号，课程号，成绩）

- [e.g.] 

  <img src="/img/design/pic3.png">

  > 部门 (部门编号，...)
  > 职员 (职员编号，部门编号，...)
  > 项目 (项目编号，项目主管职员编号，...) 
  > 参加 (项目编号，职员编号)

- [e.g.] 

  <img src="/img/design/pic2.png">

  > 司机 (驾驶证，姓名，地址)
  > 汽车(车牌号，型号，出产日期)
  > 拥有(驾驶证，车牌号)
  > 事故(事故代号，地点，日期)
  > 参与(事故代号，驾驶证，车牌号，损失)



# 综合设计

-  [e.g.] 

   > - 市面上有很多书,书都有作者,而且写这本书的作者还要拿稿酬
   >
   > - 要求建立一个间题的数据库,书要求有书名,类型,单价:作者要求有姓名,电话 (1 个),地址.作者写书要求拿到稿费,并且要说明某个作者是某本书的第几作者
   >
   > - 书都是有出版社的,要求添加出版社信息,包括出版社名称和地址
   >
   > - 而书是放在某个书店卖的,要求添加书店信息和出售信息,包括书店名和地址,某本书的出售时间,卖出本数

  <img src="/img/design/pic5.png">
  
  > book(<u>bid</u>, author, type, price, pid)
  > store(<u>sid</u>, sname, sloc)
  > author(<u>tel</u>, aname, addr)
  > publisher(<u>pid</u>, pname, ploc)
  > sale(<u>sid</u>, <u>bid</u>, <u>date</u>, num)
  > write(<u>bid</u>, <u>tel</u>, seq, pay)
  > \*非常易错的点：sale表中，date也是主键的一部分

 

- [e.g.]
  > - 某生产和销售体育用品的公司,拥有多个车间 ( workshop) 每个车间可生产多个产品 product,每个产品由一个或多个车间共同生产。每个车间有多名工人 ( worker),每个人一般只在一个车间工作
  >
  > - 公司在全国不同地方设立多个销售点 ( salesbranch) 每个销售点有多名销售人员 (salesperson) 负责销售产品。每个客户 (customer) 购买该公司的产品时,负责该客户的销售员要提交订单 (order),订单中列出客户此次购买行为的相关信息,如客户编号、购买日期以及购买的商品的细节信息 ( orderdetail),如产品编号、数量、折扣等。
  >
  > - 请为此公司的生产和销售系统创建实体联系模型,为实体和联系设置适当的属性,并且转化为相应的关系模式。

  <img src="/img/design/pic6.png">

  > Worker(<u>w-empID</u>, wpName, shopID)
  > WorkShop(<u>shopID</u>, shopName)
  > Product(<u>pCode</u>, pName, price)
  > Produce(<u>shopID</u>, <u>pCode</u>)
  > Customer(<u>custNo</u>, custName, custAddress, custPhoneNo)
  > Order(<u>orderNo</u>, custNo, s-empID,orderDate)
  > OrderDetail(<u>orderNo</u>, pCode, qty, discount)
  > SalesBranch(<u>branchID</u>, branchName, branchAddress)
  > SalesPerson(<u>s-empID</u>,spName,spPhoneNo, branchID)
  > \* 重难点：三元关系、传递依赖分解

